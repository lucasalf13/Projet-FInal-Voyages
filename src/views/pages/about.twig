{% extends "../layouts/base.twig" %}

{% set headerClass = 'header-banner-large' %}
{% set slogan =  t('slogan') %}

{% block style %}
	<link rel="stylesheet" href="/assets/css/style.css"/>
{% endblock %}

{% block title %}
	<title>
		{{ t('about_title') }}
		| ÉchappéeVerte
	</title>
{% endblock %}

{% block main %}
	<div class="about-container">
		<h2>{{ t('about_us') }}</h2>

		<div class="about-grid">
			{% for card in about_cards %}
				<div class="about-card">
					<span class="emoji">{{ card.emoji }}</span>
					<h3>{{ card.title }}</h3>
					<p>{{ card.text }}</p>
				</div>
			{% endfor %}
		</div>

		<div class="don-button">
			<a href="https://www.buymeacoffee.com/GoOnTheWorld" target="_blank" rel="noopener">
				<img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Achetez-moi un café">
			</a>
			<p style="white-space: pre-line;">{{ t('about_donation_message') }}</p>
		</div>
	</div>

	<div id="best-weather-card" class="weather-card" style="display:none;">
  <h3 class="weather-title">Recommandation du jour selon météo</h3>
  <h4 id="best-weather-city" class="weather-city"></h4>
  <p id="best-weather-desc" class="weather-desc"></p>
  <img id="best-weather-icon" alt="Météo icône" class="weather-icon">
</div>

{% endblock %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', async () => {
  try {
    // 1. Récupérer la ville recommandée (avec lat/lon)
    const resTopVille = await fetch('/api/meteo/top-ville');
    const topVille = await resTopVille.json();

    if (topVille && topVille.lat && topVille.lon && topVille.city) {
      // 2. Récupérer la météo complète (prévisions + actuel) pour cette ville
      const resMeteo = await fetch(`/api/meteo/${topVille.lat}/${topVille.lon}`);
      const meteoData = await resMeteo.json();

      // 3. Extraire la météo du jour (forecast)
      const todayForecast = meteoData.forecast.forecastday[0].day;

      // 4. Mettre à jour l'affichage avec la température max du jour + condition du jour
      const card = document.getElementById('best-weather-card');
      document.getElementById('best-weather-city').textContent = topVille.city;
      document.getElementById('best-weather-desc').textContent =
        `${todayForecast.condition.text}, max ${todayForecast.maxtemp_c}°C aujourd’hui`;
      const icon = document.getElementById('best-weather-icon');
      icon.src = "https:" + todayForecast.condition.icon;
      icon.alt = `Icône météo ${todayForecast.condition.text}`;
      card.style.display = 'block';
    }
  } catch (err) {
    console.error('Erreur fetch météo:', err);
  }
});
</script>
{% endblock %}

